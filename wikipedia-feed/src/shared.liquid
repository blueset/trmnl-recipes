<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">

<style>
  @import url("https://fontsapi.zeoseven.com/359/main/result.css"); /* ChillBitmap_16px */
  @import url("https://fontsapi.zeoseven.com/570/12px/result.css"); /* Fusion Pixel 12px P latin Regular */
  
  @font-face {
    font-family: 'UnifontExMono';
    src: url('https://stgiga.github.io/UnifontEX/UnifontExMono.ttf')  format('truetype'),
         url('https://stgiga.github.io/UnifontEX/UnifontExMono.woff2') format('woff2');
  }
  @font-face{
    font-family: "Hibiya24";
    src: url("https://togaras1.net/assets/font/KH-Dot-Hibiya-24.woff") format("woff");
  }
  @font-face {
      font-family: 'Unifont';
      src: url('https://konard.github.io/twittermatrix/unifont.woff') format('woff'), url('https://konard.github.io/twittermatrix/unifont.ttf') format('truetype');
  }
  @font-face {
      font-family: fusion-pixel-12px-proportional-zh_hans;
      src: url("https://fusion-pixel-font.takwolf.com/fusion-pixel-12px-proportional-zh_hans.otf.woff2");
  }
  @font-face {
      font-family: 'C16XCN';
      font-weight: bold;
      src: url('https://blueset.github.io/wikipedia-featured/fonts/c16xcnb.woff2') format('woff2'),
           url('https://blueset.github.io/wikipedia-featured/fonts/c16xcnb.ttf') format('truetype');
  }
  @font-face {
      font-family: 'C16XCN';
      font-weight: normal;
      src: url('https://blueset.github.io/wikipedia-featured/fonts/c16xcnr.woff2') format('woff2'),
           url('https://blueset.github.io/wikipedia-featured/fonts/c16xcnr.ttf') format('truetype');
  }
  @font-face {
    font-family: 'C24XCN';
    src: url('https://blueset.github.io/wikipedia-featured/fonts/c24xcn.woff2') format('woff2'),
         url('https://blueset.github.io/wikipedia-featured/fonts/c24xcn.ttf') format('truetype');
  }
  @font-face {
      font-family: 'JF-Dot-Shinonome16';
      font-weight: bold;
      src: url('https://blueset.github.io/wikipedia-featured/fonts/JF-Dot-Shinonome16B.woff2') format('woff2'),
           url('https://blueset.github.io/wikipedia-featured/fonts/JF-Dot-Shinonome16B.ttf') format('truetype');
  }
  @font-face {
      font-family: 'JF-Dot-Shinonome16';
      font-weight: normal;
      src: url('https://blueset.github.io/wikipedia-featured/fonts/JF-Dot-Shinonome16.woff2') format('woff2'),
           url('https://blueset.github.io/wikipedia-featured/fonts/JF-Dot-Shinonome16.ttf') format('truetype');
  }
  @font-face {
      font-family: 'Helvetica 17';
      src: url('https://blueset.github.io/xorg-fonts/font-adobe-100dpi-1.0.4/helvR12.ttf') format('truetype');
      font-weight: 500;
      font-style: normal;
  }
  @font-face {
      font-family: 'Helvetica 17';
      src: url('https://blueset.github.io/xorg-fonts/font-adobe-100dpi-1.0.4/helvB12.ttf') format('truetype');
      font-weight: 700;
      font-style: normal;
  }
  @font-face {
      font-family: 'Helvetica 17';
      src: url('https://blueset.github.io/xorg-fonts/font-adobe-100dpi-1.0.4/helvBO12.ttf') format('truetype');
      font-weight: 700;
      font-style: oblique;
  }
  @font-face {
      font-family: 'Helvetica 17';
      src: url('https://blueset.github.io/xorg-fonts/font-adobe-100dpi-1.0.4/helvO12.ttf') format('truetype');
      font-weight: 500;
      font-style: oblique;
  }
  @font-face {
      font-family: 'Utopia 25';
      src: url('https://blueset.github.io/xorg-fonts/font-adobe-utopia-100dpi-1.0.5/UTRG__18.ttf') format('truetype');
      font-weight: 400;
      font-style: normal;
  }
  @font-face {
      font-family: 'Utopia 25';
      src: url('https://blueset.github.io/xorg-fonts/font-adobe-utopia-100dpi-1.0.5/UTBI__18.ttf') format('truetype');
      font-weight: 700;
      font-style: italic;
  }
  @font-face {
      font-family: 'Utopia 25';
      src: url('https://blueset.github.io/xorg-fonts/font-adobe-utopia-100dpi-1.0.5/UTB___18.ttf') format('truetype');
      font-weight: 700;
      font-style: normal;
  }
  @font-face {
      font-family: 'Utopia 25';
      src: url('https://blueset.github.io/xorg-fonts/font-adobe-utopia-100dpi-1.0.5/UTI___18.ttf') format('truetype');
      font-weight: 400;
      font-style: italic;
  }
  
  :where(.screen--md, .screen--sm) .richtext .content p {
    line-height: 20px;
    word-break: normal;
  }

  .trmnl .screen--4bit {
    .wiki-richtext .title {
      &:lang(bn), &:lang(el), &:lang(en), &:lang(hu), &:lang(sv), &:lang(zh) {
        font-family: 'Linux Libertine','Georgia','Times','Source Serif 4',serif;
      }
      &:lang(de), &:lang(vi) {
        font-family: "Linux Libertine","Palatino Linotype","Georgia","Times",serif;
      }
      &:lang(sd) {
        font-family: "SSRead",Georgia,Arial,Calibri,Times,sans-serif;
      }
      &:lang(ur) {
        font-family: "Jameel Noori Nastaleeq","Mehr Nastaliq Web","Alvi Lahori Nastaleeq","Alvi Nastaleeq","Nafees Nastaleeq","Nafees Nastaleeq v1.01","Pak Nastaleeq","Urdu Emad Nastaleeq","PDMS_Jauhar","Urdu Typesetting",Nafees,IranNastaliq,Amiri,Georgia,"Times New Roman",Times,sans-serif;
      }
    }
  }
  
  .trmnl .screen--1bit, .trmnl .screen--2bit {
    --richtext-font-family: 'Helvetica 17', sans-serif;
    --richtext-font-size: 18px;
    --title-font-family: 'Utopia 25', serif;
    --title-font-size: 29px;
    .richtext .content:lang(ja), .content:lang(ja),
    .title_bar .title:lang(ja), .title_bar .title:lang(ja){
      font-family: "JF-Dot-Shinonome16", "DotGothic16", sans-serif;
      padding-top: 0;
      font-size: 16px;
    }
    .richtext .content:lang(zh), .content:lang(zh),
    .title_bar .title:lang(zh), .title_bar .title:lang(zh){
      font-family: "寒蝉点阵体 16px", "C16XCN", "Unifont", sans-serif;
      padding-top: 0;
      font-size: 16px;
    }
    .label.label--small:lang(ja), .label.label--small:lang(ja) {
      font-family: "UnifontExMono", sans-serif;
    }
    .label.label--small:lang(zh), .label.label--small:lang(zh) {
      font-family: "寒蝉点阵体 16px", "C16XCN", "Unifont", sans-serif;
    }
    .title:lang(ja), .title:lang(ja) {
      font-family: "Hibiya24", sans-serif;
      font-size: 24px;
    }
    .title:lang(zh), .title:lang(zh) {
      font-family: "C24XCN", "Hibiya24", "NanoDyongChyangSong TCN 24", "Unifont", serif;
      font-size: 24px;
    }
    .description:lang(zh) {
      font-family: "Fusion Pixel 12px P latin", sans-serif;
      font-size: 12px;
    }
    
    b {
      text-decoration: underline dotted;
    }
  }
  .trmnl .screen--4bit .richtext .content b {
    font-weight: 800;
    font-variation-settings: "wght" 800;
  }
  .title_bar .title {
    width: 0;
    flex-grow: 1;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .title_bar .instance {
    flex-grow: 0;
  }

  .wiki-columns {
    height: 100%;
    align-items: center;
  }
  .wiki-column {
      justify-content: safe center;
      overflow: hidden;
  }
  
  .wiki-richtext .content {
      overflow: hidden;
  }
  
  .wiki-richtext, .wiki-itn, .wiki-dyn {
      max-height: 100%;
      overflow: hidden;
  }
  .wiki-richtext .content {
    display: -webkit-box;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .wiki-itn a, .wiki-dyn a {
    text-decoration: none;
    color: inherit;
  }

  .wiki-dyn:lang(zh) b > a::after, .wiki-dyn:lang(zh) a:has(b)::after {
    content:  " (" attr(title) ")"
  }

  .wiki-ongoing:lang(en)::before {
    content: "Ongoing: ";
  }
  .wiki-recent-deaths:lang(en)::before {
    content: "Recent deaths: ";
  }
  .wiki-ongoing:lang(zh)::before {
    content: "正在发生：";
  }
  .wiki-recent-deaths:lang(zh)::before {
    content: "最近逝世：";
  }
</style>

{% liquid 
  assign language = trmnl.plugin_settings.custom_fields_values.language
  assign view = ""
  if language == "en"
    assign view = trmnl.plugin_settings.custom_fields_values.en_view
  elsif language == "zh"
    assign view = trmnl.plugin_settings.custom_fields_values.zh_view
  endif
%}

<div class="layout" lang="{{ language }}">
  {% if view == "dyn" %}
  <div class="flex flex-row gap wiki-dyn">
    <div class="flex flex--col gap" data-overflow="true">
      {% for fact in facts %}
      <div class="item richtext">
        <div class="meta"></div>
        <div class="full:lg:content-large content">
          <p>{{ fact.html }}</p>
        </div>
      </div>
      {% endfor %}
    </div>
    {% if image.url %}
    <figure class="quad:hidden vert:hidden flex flex--center-y flex--col max-w-[30%] content" style="align-self: stretch;">
      <img src="{{ image.url }}" alt="{{ image.alt }}" class="w--full image image-dither image--contain" style="max-height: calc(100% - var(--description-font-size) - var(--gap));" />
      {% if image.caption %}<figcaption class="description">{{ image.caption }}</figcaption>{% endif %}
    </figure>
    {% endif %}
  </div>
  {% elsif view == "itn" %}
  <div class="flex flex-row full:port:flex-col-reverse lg:vert:flex-col-reverse gap wiki-itn">
    <div class="flex flex--col gap" data-overflow="true">
      {% for headline in headlines %}
      <div class="item richtext">
        <div class="meta"></div>
        <div class="full:lg:content-large content">
          <p>{{ headline.html }}</p>
        </div>
      </div>
      {% endfor %}
      <div class="item">
        <div class="meta"></div>
        <div class="content">
          <span class="description full:lg:description-large wiki-ongoing">{% for og in ongoing %}{{ og.text }}{% unless forloop.last %} · {% endunless %}{% endfor %}</span>
        </div>
      </div>
      <div class="item">
        <div class="meta"></div>
        <div class="content">
          <span class="description full:lg:description-large wiki-recent-deaths">{% for rd in recentDeaths %}{{ rd.name }}{% unless forloop.last %} · {% endunless %}{% endfor %}</span>
        </div>
      </div>
    </div>
    {% if image.url %}
    <figure class="quad:hidden vert:hidden flex lg:vert:flex flex--center-y flex--col max-w-[30%] lg:port:vert:max-w-[60%] content" style="align-self: stretch;">
      <img src="{{ image.url }}" alt="{{ image.alt }}" class="w--full image image-dither image--contain" style="max-height: calc(100% - var(--description-font-size) - var(--gap));" />
      {% if image.caption %}<figcaption class="description">{{ image.caption }}</figcaption>{% endif %}
    </figure>
    {% endif %}
  </div>
  {% else %}
  <div class="columns wiki-columns">
    <div class="column wiki-column">
      <div class="gap--medium richtext richtext--center wiki-richtext">
        <span class="text--center title lg:title--xlarge" dir="auto">{{ title }}</span>
        {% if description %}<span class="text--center label label--small lg:label--base" dir="auto">{{ description }}</span>{% endif %}
        <div class="lg:content--large content" dir="auto">
          {{ extract_html }}
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</div>

<div class="title_bar" lang="{{ language }}">
  <img class="image image-stroke" src="https://upload.wikimedia.org/wikipedia/commons/5/5a/Wikipedia%27s_W.svg">
  <span class="title">{{ trmnl.plugin_settings.instance_name }}</span>
  <span class="instance">{{ timestamp | default: "now" | date: trmnl.plugin_settings.custom_fields_values.date_format }}</span>
</div>

<script>
  (() => {
    const root = document.currentScript.closest(".view");
    const content = root.querySelector(".wiki-richtext .content");
    const p = root.querySelector(".wiki-richtext .content p");
    function measure(reset) {
      if (reset && content) {
        content.style.webkitLineClamp = "";
      }
      const height = content.getBoundingClientRect().height;
      const lineHeight = parseInt(getComputedStyle(p || content).lineHeight);
      const lines = Math.floor(height / lineHeight);
      console.log("clamp lines to", lines, height, lineHeight, content);
      content.style.webkitLineClamp = lines;
    }
    const resizeObserver = new ResizeObserver((entries) => {
      const reset = entries.filter(e => e.target.classList.contains('view') || e.target === root).length > 0;
      measure(reset);
    });
    resizeObserver.observe(root);
    if (p) resizeObserver.observe(p);
    document.fonts.ready.then(() => measure(true));
    document.fonts.addEventListener('loadingdone', () => measure(true));
    window.addEventListener('load', () => measure(true));
    window.addEventListener('resize', () => measure(true));
    window.addEventListener('orientationchange', () => measure(true));
    setTimeout(() => {
      measure(true)
      document.fonts.ready.then(() => {
        measure(true)
      });
    }, 2000);
  })();
</script>


<script type="module">
import * as tailwindcss from "https://esm.sh/tailwindcss@4";
import plugin from "https://esm.sh/tailwindcss/plugin";
const cssIndex = await fetch("https://esm.sh/tailwindcss@4/index.css").then(res => res.text())
const cssPreflight = await fetch("https://esm.sh/tailwindcss@4/preflight.css").then(res => res.text())
const cssTheme = await fetch("https://esm.sh/tailwindcss@4/theme.css").then(res => res.text())
const cssUtilities = await fetch("https://esm.sh/tailwindcss@4/utilities.css").then(res => res.text())
const STYLE_TYPE = "text/tailwindcss";
let compiler;
let classes = new Set();
let lastCss = "";
let sheet = document.createElement("style");
let buildQueue = Promise.resolve();
let nextBuildId = 1;
async function createCompiler() {
  let stylesheets = document.querySelectorAll(`style[type="${STYLE_TYPE}"]`);

  let css = "";
  for (let sheet of stylesheets) {
    observeSheet(sheet);
    css += sheet.textContent + "\n";
  }

  if (!css.includes("@import")) {
    css = `@import "tailwindcss";${css}`;
  }

  // The input CSS did not change so the compiler does not need to be recreated
  if (lastCss === css) return;

  lastCss = css;

  try {
    compiler = await tailwindcss.compile(css, {
      base: "/",
      loadStylesheet,
      loadModule,
    });
  } finally {
  }

  classes.clear();
}

async function loadStylesheet(id, base) {
  function load() {
    if (id === "tailwindcss") {
      return {
        path: "virtual:tailwindcss/index.css",
        base,
        content: cssIndex,
      };
    } else if (
      id === "tailwindcss/preflight" ||
      id === "tailwindcss/preflight.css" ||
      id === "./preflight.css"
    ) {
      return {
        path: "virtual:tailwindcss/preflight.css",
        base,
        content: cssPreflight,
      };
    } else if (
      id === "tailwindcss/theme" ||
      id === "tailwindcss/theme.css" ||
      id === "./theme.css"
    ) {
      return {
        path: "virtual:tailwindcss/theme.css",
        base,
        content: cssTheme,
      };
    } else if (
      id === "tailwindcss/utilities" ||
      id === "tailwindcss/utilities.css" ||
      id === "./utilities.css"
    ) {
      return {
        path: "virtual:tailwindcss/utilities.css",
        base,
        content: cssUtilities,
      };
    }

    throw new Error(`The browser build does not support @import for "${id}"`);
  }

  try {
    let sheet = load();
    return sheet;
  } catch (err) {
    throw err;
  }
}

async function loadModule(id, base) {
  if (id === "trmnl-plugin") {
    return {
      path: "virtual:trmnl-plugin/index.js",
      base,
      module: plugin(function({ addUtilities }) {
        const utilityGroups = [
          {
            name: "content",
            varPrefix: "richtext",
            variants: ["small", "base", "large", "xlarge", "xxlarge", "xxxlarge"],
          },
          {
            name: "description",
            varPrefix: "description",
            variants: ["base", "large", "xlarge"],
          },
        ];

        const utilities = {};
        for (const { name, varPrefix, variants } of utilityGroups) {
          for (const variant of variants) {
            const infix = variant === "base" ? "" : `-${variant}`;
            utilities[`.${name}-${variant}`] = {
              "font-family": `var(--${varPrefix}${infix}-font-family)`,
              "font-size": `var(--${varPrefix}${infix}-font-size)`,
              "line-height": `var(--${varPrefix}${infix}-line-height)`,
              "font-weight": `var(--font-weight-${name}-${variant})`,
              "-webkit-font-smoothing": `var(--${varPrefix}${infix}-font-smoothing)`,
            };
          }
        }
        addUtilities(utilities);
      }),
    };
  }
}

async function build(kind) {
  if (!compiler) return;

  // 1. Refresh the known list of classes
  let newClasses = new Set();

  for (let element of document.querySelectorAll("[class]")) {
    for (let c of element.classList) {
      if (classes.has(c)) continue;

      classes.add(c);
      newClasses.add(c);
    }
  }

  if (newClasses.size === 0 && kind === "incremental") return;

  // 2. Compile the CSS

  sheet.textContent = compiler.build(Array.from(newClasses));
}

function rebuild(kind) {
  async function run() {
    if (!compiler && kind !== "full") {
      return;
    }

    let buildId = nextBuildId++;

    if (kind === "full") {
      await createCompiler();
    }

    await build(kind);
  }

  buildQueue = buildQueue.then(run);
}

// Handle changes to known stylesheets
let styleObserver = new MutationObserver(() => rebuild("full"));

function observeSheet(sheet) {
  styleObserver.observe(sheet, {
    attributes: true,
    attributeFilter: ["type"],
    characterData: true,
    subtree: true,
    childList: true,
  });
}

// Handle changes to the document that could affect the styles
// - Changes to any element's class attribute
// - New stylesheets being added to the page
// - New elements (with classes) being added to the page
new MutationObserver((records) => {
  let full = 0;
  let incremental = 0;

  for (let record of records) {
    // New stylesheets == tracking + full rebuild
    for (let node of record.addedNodes) {
      if (node.nodeType !== Node.ELEMENT_NODE) continue;
      if (node.tagName !== "STYLE") continue;
      if (node.getAttribute("type") !== STYLE_TYPE) continue;

      observeSheet(node);
      full++;
    }

    // New nodes require an incremental rebuild
    for (let node of record.addedNodes) {
      if (node.nodeType !== 1) continue;

      // Skip the output stylesheet itself to prevent loops
      if (node === sheet) continue;

      incremental++;
    }

    // Changes to class attributes require an incremental rebuild
    if (record.type === "attributes") {
      incremental++;
    }
  }

  if (full > 0) {
    return rebuild("full");
  } else if (incremental > 0) {
    return rebuild("incremental");
  }
}).observe(document.documentElement, {
  attributes: true,
  attributeFilter: ["class"],
  childList: true,
  subtree: true,
});

rebuild("full");

document.head.append(sheet);

</script>
<style type="text/tailwindcss">

@layer theme, base, components, utilities;
@import "tailwindcss/theme" layer(theme);
@import "tailwindcss/utilities" layer(utilities);
@plugin "trmnl-plugin";
  
@custom-variant lg (.screen--lg &);
@custom-variant md (.screen--md &);
@custom-variant pix (.screen--1bit &, .screen--2bit &);
@custom-variant 1bit (.screen--1bit &);
@custom-variant 2bit (.screen--2bit &);
@custom-variant 4bit (.screen--4bit &);
@custom-variant full (.view--full &);
@custom-variant hori (.view--half_horizontal &);
@custom-variant vert (.view--half_vertical &);
@custom-variant quad (.view--quadrant &);
@custom-variant land (.screen--landscape &);
@custom-variant port (.screen--portrait &);


</style>